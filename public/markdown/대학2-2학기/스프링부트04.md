### 파이썬 + 스프링웹 합쳐서 기말고사 안내 

**최종 목적** : 현재 사회 이슈(지역, 출산, 범죄, 건강-고령화, 에너지)를 해결하기 위한 정책 제안  
- (필수) 스프링부트 + 데이터 분석 및 시각화 기술 ==> 웹 서비스(대시보드 포함) 구현  
- (선택) IoT, Cloud, AI 등 추가 기술 융합 가능  
  
-> 제출 파일 : PPT 발표(10분 이내) 자료(포트폴리오), 소스코드 압축 파일(또는 github 주소 - 개발환경구축 등 README 포함)  
  
**세부 내용**  
(웹프로젝트) 스프링 부트 기반 웹 서비스(게시판-CRUD, 소셜로그인 필수 포함)  
(데이터 분석 및 시각화) 파이썬+오픈 API/공공 데이터 활용 데이터 분석 및 시각화(웹 대시보드)  
  
12월 17일 기말평가  
2인 1조  
한 사람은 웹서비스  
한 사람은 데이터 쪽 발표 하는 거임.  
  
언리얼 VR 어려워서 너무 긴 기간 막혀서 본개발 못해서  
스트레스인데 또 미루면 못하겠는데  
진짜 조정하기 개 힘들다  
  
***
  
현재 중간고사로 인해 코드 싹 바꾸었으니  
롬복 카테고리 아래부터  
전체코드 확인하고 진행해주심 됩니다.  
  
## 롬복

#### 롬복이란? 

롬복: 코드를 간소화해주는 라이브러리 
로깅: 프로그램의 수행과정을 기록으로 남기는 것  
리팩터링: 코드의 기능에는 변함 없이  
코드의 구조 또는 성능을 다시 개선하는 작업  
  
### 롬복을 활용하여 리팩터링하기 

1. 롬복 설치하기  
2. DTO 리팩터링하기  
3. 엔티티 리팩터링하기  
4. 컨트롤러에 로그 남기기  
  
### src > build.gradle의 dependencies에 추가하고 업뎃 

compileOnly 'org.projectlombok:lombok'
annotationProcessor 'org.projectlombok:lombok' 

오른쪽 그랩 버튼 눌러 컴파일 폴더 확인해서  
라이브러리 다운 잘 됐나 확인  
  
### 롬복 정리 

#### 롬복 이론 정리 

- 롬복 설치를 위해 값 변경할 파일 : build.gradle  
- 모든 필드를 매개변수로 하는 생성자를 만드는 롬복 어노테이션 : @AllArgsConstructor  
- toString() 메소드를 대체하는 롬복 어노테이션 : @ToString  
- 로깅 기능을 사용하기 위해 필요한 롬복 어노테이션 : @Slf4j  
- 출력하기 원하는 데이터를 로그로 찍기 위해 사용하는 구문 : log.info()  
  
1. 롬복  
- 코드를 간소화해주는 라이브러리  
2. 로깅  
- 프로그램의 수행 과정을 기록으로 남기는 것 (자동차 블랙박스 같은 개념)  
3. 리팩터링  
- 코드의 기능에는 변함이 없이 코드의 구조 또는 성능을 개선하는 작업  
- 래픽터링하면 코드의 가독성이 좋아지고 길이도 짧아져서 개발 시간을 단축할 수 있음  
  
#### 롬복 학습 정리 

@AllArgsConstructor  
- 클래스의 모든 필드를 매개변수로 하는 생성자를 만드는 어노테이션(생성자 메소드 기재X)  
@ToString  
- toString() 메소드를 오버라이딩한 효과와 동일함  
@Slf4j  
- 로깅할 때 사용, 로깅 기능으로 로그를 출력하면  
나중에라도 그동안 출력된 로그 검색 가능  
- log.info() 메소드 사용  
  
*** 
  
중간고사로 인해 코드가 많이 변하여  
임시 저장으로 전체 코드를 적어두겠음.  
하위 패키지명은 보고 바꾸면 됨  
  
### 롬복 수정한 전체코드 

#### Admin202318021Application 
```
package com.jvision.admin202318021;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class Admin202318021Application {
	public static void main(String[] args) {
        SpringApplication.run(Admin202318021Application.class, args);
	}
}
```
  
#### Emp 
```
package com.jvision.admin202318021;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import lombok.AllArgsConstructor;
import lombok.ToString;
import org.springframework.boot.SpringApplication;

// Emp Form 이랑 같은 상속
@AllArgsConstructor
@ToString
@Entity
public class Emp {

    @Id
    @GeneratedValue
    private Long id;

    @Column
    private String name;
    @Column
    private String dept;
    @Column
    private String position;
    @Column
    private String tel;
    @Column
    private String email;

    /*
    -> 롬복을 사용해서 필요 없어진 코드
    public Emp(Long id, String name, String dept, String position, String tel, String email) {
        this.id = id;
        this.name = name;
        this.dept = dept;
        this.position = position;
        this.tel = tel;
        this.email = email;
    }

    @Override
    public String toString() {
        return "Article {" +
                "id=" + id +
                ", name='" + name + '\'' +
                ", dept='" + dept + '\'' +
                ", position='" + position + '\'' +
                ", tel='" + tel + '\'' +
                ", email='" + email + '\'' +
                '}';
    }*/
}
```
  
#### EmpController 
```
package com.jvision.admin202318021;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

@Slf4j //이 롬복 어노테이션은 파일로 로그 모니터링 sysout 대신
@Controller
public class EmpController {
    @GetMapping("/emp")
    public String newEmpForm() {
        //머스태치 찾아옴 classpath:/templates/emp/new.mustache
        return "emp";
    }

    @Autowired
    private EmpRepository empRepository; //의존성 주입. Autowired 로 객체생성 알아서 매핑 연결 주입

    @PostMapping("/emp/register")
    public String createArticle(EmpForm form) {
        //System.out.println("입력된 데이터: " + form.toString());
        log.info(form.toString());

        Emp emp = form.toEntity();
        log.info(emp.toString());

        Emp save = empRepository.save(emp); //H2 DB에 저장
        log.info(save.toString());

        return "";
    }
}
```
  
#### EmpForm 
```
package com.jvision.admin202318021;

import lombok.AllArgsConstructor;
import lombok.ToString;

@AllArgsConstructor
@ToString
public class EmpForm {

    private String name;
    private String dept;
    private String position;
    private String tel;
    private String email;

    /*
    -> 롬복 @AllArgsConstructor가 있다면 이 문장은 필요하지 않다.

    public EmpForm(String name, String dept, String position, String tel, String email) {
        this.name = name;
        this.dept = dept;
        this.position = position;
        this.tel = tel;
        this.email = email;
    }*/

    /*
    -> 롬복 @ToString가 있다면 이 문장은 필요하지 않다.
    @Override
    public String toString() {
        return "EmpController{" +
                "name='" + name + '\'' +
                ", dept='" + dept + '\'' +
                ", position='" + position + '\'' +
                ", tel='" + tel + '\'' +
                ", email='" + email + '\'' +
                '}';
    }*/

    public Emp toEntity() {
        return new Emp(null, name, dept, position, tel, email);
    }
}
```
  
#### EmpRepository 
```
package com.jvision.admin202318021;

import org.springframework.data.repository.CrudRepository;

public interface EmpRepository extends CrudRepository<Emp, Long> {
}
```
  
#### StartprojectApplication 
```
package com.jvision.admin202318021;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class StartprojectApplication {
	public static void main(String[] args) {

        SpringApplication.run(StartprojectApplication.class, args);
	}
}
```
  
#### emp.mustache 
```
{{>layout/header}}

<!-- action에 URL경로 지정 되고, method post방식으로 보낸다. 서버를 위한 거니 둘 다 잘 해라. -->
<form class="container" action="/emp/register" method="post">
    <h2>사원 정보를 입력하세요.</h2>

    <div class="mb-3">
        <label class="form-label">사원이름</label>
        <input type="text" class="form-control" name="name">
    </div>

    <div class="mb-3">
        <label class="form-label">회사 부서</label>
        <textarea class="form-control" rows="1" name="dept"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">회사 직급</label>
        <textarea class="form-control" rows="1" name="position"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">전화번호</label>
        <textarea class="form-control" rows="1" name="tel"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">이메일</label>
        <textarea class="form-control" rows="1" name="email"></textarea>
    </div>

    <button class="submit" class="btn btn-primary">등록</button>
</form>

{{>layout/header}}
```
    
*** 
  
## 게시판 CRUD 서비스 구현 2 

학습정리  
DTO를 DB에 저장하는 과정  
  
클라이언트(머스태치파일) -> DTO(컨트롤러)-(DB에 넣을 수 있는 상태로 변환)>엔티티>리파지토리 -> DB  
  
#### 이번 CRUD 게시판 학습 목차 

1. 게시글 읽기(Read)  
2. 게시판 내 페이지 이동하기  
3. 게시글 수정하기(Update)  
4. 게시글 삭제하기(Delete)  
5. CRUD와 SQL 쿼리 종합  
  
현재 http://localhost:8080/emp 에서 값 입력하고  
http://localhost:8080/emp/1 에서 값 확인 가능  
  
#### templates > result > show.mustache 
```
{{>layout/header}}

<!-- 수정한 emp 받을 머스태치 (걍 이게 html이라 생각하면 될듯.)
부트스트랩 get 소스 코드: https://getbootstrap.com/docs/5.0/content/tables/
-->

<table class="table">
    <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">First</th>
        <th scope="col">Last</th>
        <th scope="col">Handle</th>
    </tr>
    </thead>
    <tbody>
    {{#result}}
    <tr>
        <th scope="row">{{name}}</th>
        <td>{{dept}}</td>
        <td>{{position}}</td>
        <td>{{tel}}</td>
        <td>{{email}}</td>
    </tr>
    {{/result}}
    </tbody>
</table>

{{>layout/footer}}
```
  
#### templates > emp.mustache 
```
{{>layout/header}}

<!-- action에 URL경로 지정 되고, method post방식으로 보낸다. 서버를 위한 거니 둘 다 잘 해라. -->
<form class="container" action="/emp/register" method="post">
    <h2>사원 정보를 입력하세요.</h2>

    <div class="mb-3">
        <label class="form-label">사원이름</label>
        <input type="text" class="form-control" name="name">
    </div>

    <div class="mb-3">
        <label class="form-label">회사 부서</label>
        <textarea class="form-control" rows="1" name="dept"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">회사 직급</label>
        <textarea class="form-control" rows="1" name="position"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">전화번호</label>
        <textarea class="form-control" rows="1" name="tel"></textarea>
    </div>

    <div class="mb-3">
        <label class="form-label">이메일</label>
        <textarea class="form-control" rows="1" name="email"></textarea>
    </div>

    <button class="submit" class="btn btn-primary">등록</button>
</form>

{{>layout/header}}
```
  
#### Emp 
```
package com.jvision.admin202318021;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;
import lombok.ToString;
import org.springframework.boot.SpringApplication;

// Emp Form 이랑 같은 상속
@AllArgsConstructor
@ToString
//생성자?자동생성
@NoArgsConstructor
@Entity
public class Emp {

    @Id
    @GeneratedValue
    private Long id;

    @Column
    private String name;
    @Column
    private String dept;
    @Column
    private String position;
    @Column
    private String tel;
    @Column
    private String email;
}
```
  
#### EmpController 
```
package com.jvision.admin202318021;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.Optional;

@Slf4j
@Controller
public class EmpController {
    // 이거 슬래시 해야하네
    @GetMapping("/emp")
    public String newEmpForm() {
        //머스태치 찾아옴 classpath:/templates/emp/new.mustache
        return "emp";
    }

    @Autowired
    private EmpRepository empRepository;

    @PostMapping("/emp/register")
    public String createArticle(EmpForm form) {
        //System.out.println("입력된 데이터: " + form.toString());
        log.info(form.toString());

        Emp emp = form.toEntity();
        log.info(emp.toString());

        Emp save = empRepository.save(emp); //H2 DB에 저장
        log.info(save.toString());

        return "";
    }

    @GetMapping("/emp/{id}")
    public String show(@PathVariable Long id, Model model) {
        //http://localhost:8080/emp/1 이렇게 검색하면 됨.
        log.info("id: "+ id);

        // private empRepository 로 담아온 거 사용
        //Optional<Emp> empEntity = empRepository.findById(id); -> 이런 것도 된다. (근데 머스테치에 뭐 추가해야 함)
        Emp empEntity = empRepository.findById(id).orElse(null); //조건 null 허용

        model.addAttribute("result", empEntity);

        return "result/show";
    }
}
```
  
### 테이블 리스트형으로 받기 

#### EmpController 
```
package com.jvision.admin202318021;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import java.util.List;
import java.util.Optional;

@Slf4j
@Controller
public class EmpController {
    // 이거 슬래시 해야하네
    @GetMapping("/emp")
    public String newEmpForm() {
        //머스태치 찾아옴 classpath:/templates/emp/new.mustache
        return "emp";
    }

    @Autowired
    private EmpRepository empRepository;

    @PostMapping("/emp/register")
    public String createArticle(EmpForm form) {
        //System.out.println("입력된 데이터: " + form.toString());
        log.info(form.toString());

        Emp emp = form.toEntity();
        log.info(emp.toString());

        Emp save = empRepository.save(emp); //H2 DB에 저장
        log.info(save.toString());

        return "";
    }

    // 단일 데이터 조회용
    @GetMapping("/emp/{id}")
    public String show(@PathVariable Long id, Model model) {
        //http://localhost:8080/emp/1 이렇게 검색하면 됨.
        log.info("id: "+ id);

        // private empRepository 로 담아온 거 사용
        //Optional<Emp> empEntity = empRepository.findById(id); -> 이런 것도 된다. (근데 머스테치에 뭐 추가해야 함)
        Emp empEntity = empRepository.findById(id).orElse(null); //조건 null 허용

        model.addAttribute("resultmd", empEntity);

        return "result/showmd";
    }

    // 데이터 목록 조회용
    @GetMapping("/emp/list")
    public String index(Model model) {

        List<Emp> empEntity = (List<Emp>) empRepository.findAll();

        model.addAttribute("resultList", empEntity);

        return "result/index";
    }
}
```
  
#### templates > result > index.mustache 
```
{{>layout/header}}

<table class="table">
    <thead>
    <tr>
        <th scope="col">#</th>
        <th scope="col">First</th>
        <th scope="col">Last</th>
        <th scope="col">Handle</th>
    </tr>
    </thead>
    <tbody>
    {{#resultList}}
    <tr>
        <th scope="row">{{name}}</th>
        <td>{{dept}}</td>
        <td>{{position}}</td>
        <td>{{tel}}</td>
        <td>{{email}}</td>
    </tr>
    {{/resultList}}
    </tbody>
</table>

{{>layout/footer}}
```
  


