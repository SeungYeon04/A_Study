
#### (문제 1) midwest.csv를 불러와 데이터의 특징을 파악하세요. 
```
import pandas as pd

person = pd.read_csv("midwest.csv")
person
```
  
#### (문제 2) poptotal(전체 인구) 변수를 total로, popasian(아시아 인구) 
```
person = person.rename(columns = {'poptotal' : 'total', 'popasian' : 'asian'})
```
  
#### (문제 3) total, asian 변수를 이용해 ‘전체 인구 대비 아시아 인구 백분율’ 파생변수(ratio)를 추가하고, 히스토그램을 만들어 분포를 살펴보세요.
```
(이부분 재미니가 도와줌)  
person['total'] = pd.to_numeric(person['total'], errors='coerce')  
person['asian'] = pd.to_numeric(person['asian'], errors='coerce')  
  
'ratio' 파생 변수 생성  
person['ratio'] = (person['asian'] / person['total']) * 100  
```
    
#### (문제 4) 아시아 인구 백분율 전체 평균을 구하고, 평균을 초과하면 ‘large’, 그 외에는 ‘small’을 부여한 파생변수(‘result‘)를 만들어 보세요.

캡스톤 문제 처리 후 ㄱㄱ  

*** 
  
### 교수님의 아침 말씀 
  
#### 우리 특허 출헌한다?! 

나 전꺼 까먹었나?  
특허청장상 받으면 좋다  
우리 특허 출헌할 거고  
2년 후 쯤 등록하면 오케이  
일단 너네 정보 받을 거다.  
우리 관계개선앱은  
원래 뭐야 이게? 싶었는데  
너네가 나를 만나 다듬어가며  
직접 내서 들고 온 아이디어니까 돋보인다  
자부심을 가져도 된다.  
이력서 한 줄 미쳤다.  
  
교수님 학생 햄복하게 잘하시는군요  
  
#### 나이의 딜레마 

IT 40대부턴 힘들고  
40대면 기승전 닭튀김이라고 해  
치킨집 창업 한다고 우리 딴 얘기다.  
요런 말씀을 하셨다.  
근데 그분은 연세도 있으시고 가정도 있으시지만  
진짜 열심히 하셨고 학생들이 몰리는 곳 아닌  
빅데이터 AI분야로 해서 잘 들어갔다.  
역량을 좋게 생각해서 ㄱㄴ  
그 회사 언리얼 필요하다해서  
학교에서 배울 수 있도록 했다고 함.  
  
#### 외국인 유학생 이야기 

미국 영주권 하면  
한국 돈 기준 8천 이상 벌어야.  
이 분야에서 전문직 비자  
아무나 대주지 않음.  
대상자 굿굿  
  
지속적으로 공부하고 포폴 업뎃해야 함.  
그러지 않으면 꽂아줄 수도 없음.  
  
취업 전 프로젝트 포폴로 완성  
그중 하나는 캡스톤 디자인  
상을 받고 한 것보다  
처음부터 끝까지 같이 하거나  
혼자 끝까지 하면 취업을 한다.  
  
길을 정했으면 시간 노력 투자해.  
집중 잘 안된다 돈이 필요하다면 직무 바꿔라  
이상은 여기고 현실은 여기면 이상과 현실을 맞춰야지  
대학 나가고 소속 없어지고 집에 있으면 성격 변함.  
열심히 하면 상상 못한 자리에 감. 첫 술에 배부르지 않으니  
스텝 by 스텝  
  
*** 
  
2025-09-30  
  
### 수업 시작 

#### 이번주 할 것: 데이터 전처리 

데이터 분석 전에 전처리  
자르고 붙이고 등 가공하고 테이블 확보하는 작업  
  
### 한글파일의 요약버전 
```
##1. 결측치 정제하기
pd.isna(df).sum()
df_nomiss = df.dropna(subset = ‘score’)
df_nomiss = df.dropna(subset = [‘score’, ‘sex’])

##2. 이상치 정제하기

#이상치 확인하기
df[‘sex’].value_counts().sort_index()

#이상치 결측 처리
df[‘sex’] = np.where(df[‘sex’] == 3, np.nan, df[‘sex’])

#상자 그림으로 극단치 기준 찾기
sns.boxplot(data = mpg, y = ‘hwy’)
(1사분위수) pct25 = mpg[‘hwy’].quantile(.25)
(3사분위수) pct75 = mpg[‘hwy’].quantile(.75)
(IQR) iqr = pct75 – pct25
(하한) pct25 – 1.5 * iqr 
(상한) pct75 + 1.5 * iqr

#극단치 결측 처리
mpg[‘hwy’] = np.where((mpg[‘hwy’] < 4.5) | (mpg[‘hwy’] > 40.5), np.nan, mpg[‘hwy’])   
```
  
### 수업 과정 

#### 결측치 추가 (NaN화) 
```
# 데이터 정제하기 (결측치/이상치)

# 결측지 데이터 생성하기 
import pandas as pd 
import numpy as np 

num1 = pd.DataFrame({'sex': ['M', 'F', np.nan, 'M', 'F'],
             'score':[5,4,3,4,np.nan]})
num1

--- 

num1['score']+1
num1

--- 

num1['score'].sum()

--- 

num1['score'].mean()
  
--- 

pd.isna(num1) #결측치(=NaN) 체크 
  
--- 

num1.dropna(subset = 'sex') 

--- 

# 엑셀파일 열어서 하기 
examfile = pd.read_csv('exam.csv')
examfile

--- 

examfile.loc[[2,7,14], ['math']] = np.nan # math의2, 7, 14행을 NaN 결측치로 변경
examfile 

--- 

# 용어: 결측치 대체법
# 위에서 NaN 처리하고 이제 그곳에 평균값 등 새로 끼워넣기 

examfile['math'].mean() 

--- 

examfile['math'] = examfile['math'].fillna(55)
examfile 

--- 

# 결측치 정리 
examfile.loc[[2,7,14], ['math']] = np.nan # NaN값 넣기 
examfile['math'].isna().sum() # 해당 필드에 결측치 NaN가 몇 개인가

--- 

examfile['math'] = examfile['math'].fillna(55) # NaN위치에 55겂 채우기
examfile 

--- 

examfile['math'].isna().sum() # NaN갯수 세기 

--- 

# 혼자 해보기 코너 
mpg = pd.read_csv('mpg.csv')
mpg.loc[[64,123,130,152,211], ['hwy']] = np.nan 
mpg['hwy'].isna().sum() 

---

# 1. drv(구동방식)별로 hwy(고속도로 연비) 평균이 어떻게 다른가 알아볼 거임 
# 분석하기 전 우선 두 변수의 결측치 있나 확인 drv와 hwy에 몇 개인가 

print("drv의 결측치: " + str(mpg['drv'].isna().sum())
     + "\nhwy의 결측치: " + str(mpg['hwy'].isna().sum())) 
# drv의 결측치: 0
# hwy의 결측치: 5
--- 

# 2. df.dropna()를 이용해 ,hwy 결측치 제거하고 
# 어떤 구동방식의 hwy평균이 높은지 알아보세요 
# 하나의 pandas 구문으로 만들어주세요 

mpg.dropna(subset='hwy').groupby('drv').agg(mean_hwy=('hwy', 'mean'))
```
  
#### 이상치 체크 01 (정상범위를 크게 벗어난 값) 
```
# 이상치 구하기 
# 이상치 : 정상범위를 크게 벗어난 값을 
# 이상치라고 한다. 
# 오류는 아니지만 극단적인 값으로 드물게 발생한 것이며 
# 결과 외곡 방지를 위한 이상치 제거해 평균 내는 과정 

import pandas as pd 
import numpy as np 

num2 = pd.DataFrame({ 'sex' : [1,2,1,3,2,1],
    'score' : [5,4,3,4,2,6]
})
num2

--- 

# 빈도표 생성 (특정 값의 나온 빈도 수 테이블로) 
# 데이터에 이상치가 있는지 확인하기 좋은 
# value_counts() 빈도표 생성 메소드 
num2['sex'].value_counts()

--- 

num2['score'].value_counts().sort_index()

--- 

# sex 가 3이면 NaN 부여 
import numpy as np 

# where(조건반복)을 이용해 결측(NaN) 처리 
num2['sex'] = np.where(num2['sex'] == 3, np.nan, num2['sex'])

--- 

# score 가 1~5 사이의 값이 아니라면 NaN 부여

num2['score'] = np.where(num2['score'] > 5, np.nan, num2['score'])
num2 

--- 

# NaN 결측 데이터를 삭제한 후 분석하기 
# 성별에 따른 score 평균 계산하기 

# 성별 1일 때 2일 때 스코어 평균 
num2.dropna(subset = ['sex', 'score'])\
    .groupby('sex')\
    .agg(mean_score = ('score', 'mean'))
```
결과  
1.0 / 4.0  
2.0 / 3.0  
  
#### 이상치 체크 02 (정상범위를 크게 벗어난 값) 

```
# 이상치(극단적인 값) 제거 실습 
# 상자그림으로 극단치 기준 정하기 

import seaborn as sns 
import pandas as pd 
import numpy as np 

mpg = pd.read_csv('mpg.csv')
sns.boxplot(data = mpg, y = 'hwy')

# _ 선이 극단치 상한경계 
# * * 동그라미 쪽은 극단치 
# 상한 하한 극단치 경계 넘어가면 값 지워야 함. 

--- 

# 극단치 경계가 되는 상한 하한 구하기 
# 하한: 1사분위수보다 IQR의 1.5배 만큼 더 작은 값 
# 상한: 3사분위수보다 IQR의 1.5배 만큼 더 큰 값 
# pct25 - 1.5 * iqr 
# pct75 + 1.5 * iqr 
# 이 두 개의 결과값보다 크거나 작으면 극단치 
# 박스 테이블 기준으론 수치를 정확히 알 수 없음. 
# 원래 100중으로 상위 하위 25, 75로 기준해서 듯. 

# 아래 라인 (1사분위수)
pct25 = mpg['hwy'].quantile(.25)
pct25

--- 

# 상위 라인 (3사분위수)
pct75 = mpg['hwy'].quantile(.75)
pct75

--- 

# 중앙라인 
pct50 = mpg['hwy'].quantile(.50)
pct50

--- 

# IQR 연산하기 (3사분위수 ~ 1사분위수)

iqr = pct75 - pct25
iqr

--- 

# 극단치경계(상한, up)(하한, down) 구하기 
up = pct75 + 1.5 * iqr
down = pct25 - 1.5 * iqr 
up # 40.5
down # 4.5

--- 

# 극단치 --> 결측(NaN) 처리 

# 4.5보다 크거나 또는 40.5보다 작으면 NaN처리 아니면, 그대로 유지 
mpg['hwy'] = np.where((mpg['hwy'] < 4.5) | (mpg['hwy'] > 40.5),
                     np.nan, mpg['hwy']) 

# 결측치 데이터 수 확인 
mpg['hwy'].isna().sum()

--- 

# 결측치 제거하고 분석하기 
mpg.dropna(subset = 'hwy')\
    .groupby('drv')\
    .agg(mean_hwy = ('hwy', 'mean'))
```
  
#### 과제 문제: 극단치 -> 결측치 & 이상치 -> 이상치 제거, 정상값 평균화

```
# 우선 mpg 데이터를 불러와 일부러 이상치 만들 거 
# drv(구동방식) 변수의 값은 
# 4 사륜구동 f 전륜구동 r 후륜구동입니다. 
# 몇 개의 행에 존재할 수 없는 값 k 를 할당하겠음. 
# cty 도시연비 변수도 몇 개의 행에 극단적으로 크거나 작은 값 할당합니다. 
# 구동방식별로 연비 다른지 알아볼 건데 
# 분석하기 전 두 변수의 이상치를 체크하려 합니다. 

import pandas as pd 
import numpy as np 
import seaborn as sns 

# mpg 데이터 불러오기 
mpg = pd.read_csv('mpg.csv')

# drv 이상치 할당하기 
mpg.loc[[9,13,57,92], 'drv'] = 'k'

# cty 이상치 할당하기 
mpg.loc[[28,42,128,202], 'cty'] = [3,4,39,42]

sns.boxplot(data=mpg, y='cty')

--- 

# Q2. 상한 하한으로 극단치값 없애기 
num1su = mpg['cty'].quantile(.25)
num3su = mpg['cty'].quantile(.75)

# IQR 연산하기 (3사분위수 ~ 1사분위수)
iqr = num3su - num1su

# 상한: 3사분위수 + 1.5 * UQR 
# 하한: 1사분위수 - 1.5 * IQR 
sangHan = num3su + 1.5 * iqr 
haHan = num1su - 1.5 * iqr

print("상한값: " + str(sangHan) + " 하한값: " + str(haHan))

--- 

# 극단치 결측화 
mpg['cty'] = np.where((mpg['cty'] < 6.5) | (mpg['cty'] > 26.5),
                     np.nan, mpg['cty']) 
mpg['cty'].isna().sum() # 9개 
sns.boxplot(data=mpg, y='cty') # 이제 *** 이런 모양 사라짐. 

---

# Q1. drv에 이상치(k)가 있는지 확인하세요 
# 이상치를 결측처리하고 이상치 사라졌나 확인하세요 
# 결측처리는 df.isin() 쓰세요 
# 힌트: drv가 정상값이면 유지 아니면 NaN 부여 
# np.where(mpg['drv'].isin('4','f','r').mpg['drv'], np.nan) 

esangchi = mpg['drv'].value_counts().sort_index() # 이상치확인 
esangchi = np.where(mpg['drv'] == 'k', np.nan, mpg['drv']) # 이상치결측처리 
# 조건반복으로 esangchi깂에 drv 값이 k 면 NaN결측 아니면 그대로 넣는다. 

np.isin(esangchi, ['k']).any() # False : k 가 남아있지 않음. 모두 NaN

--- 

# Q3. 이상치를 제거한 다음 drv별로 cty 평균이 어떻게 다른지 알아보세요 
# 하나의 pandas구문으로 만들어야 함. 
# 힌트: df.dropna()를 이용해 drv와 cty가 모두 
# 결측치가 아닌 데이터를 추출한 다음 
# 집단별 평균을 구하면 됩니다. 

# 여기서 4, f, r 별로 mpg[인덱스 기준으로 4,r,f별 평균 내기? nan위치 빼고? 
# 이럴 줄 알았으면 같은 리스트로 했을텐데 ㅎㅅㅎ]
# esangchi와 cty 를 직접비교 하란 건데.. 인터넷 찬뜨(=그룹핑 해야 한다.)

# 이상치 제거한 esangchi(옛drv) 기준 cty 평균
esangchi_mean = mpg.dropna(subset=['cty']).groupby(esangchi)['cty'].mean()
esangchi_mean
```
Q1결과 (=이상치는 isin로 결측처리하고 사라졌나 체크):  
np.False_  
  
Q2결과 (=상한 하한으로 극단치값 없애기) :  
(대략 그래프에 동그라미들이 없어짐.)  
  
Q3결과 (=이상치 제거된 drv값 dropna()로 cty 집단평균 내기):  
4 / 14.660000  
f / 19.849057  
r / 13.958333  
Name: cty, dtype: float64  
  
